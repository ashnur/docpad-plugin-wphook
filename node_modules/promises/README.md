this is just a rewrite of what Crockford did.
